# SQLess

**自然語言驅動的資料庫查詢系統**

SQLess = SQL + Less，意味著使用者完全無需理解 SQL，也能輕鬆使用自然語言進行數據查詢。

---

## 版本資訊

- **V1：2025-2-8**  
  Template、Views 設計完成（尚未整合）。

---

## 目標與優勢

**SQLess 的目的：**  
專為解決 Data Mart 中查詢問題而設計，旨在克服多表、多 Schema 的環境下傳統 Text-to-SQL 工具的限制，並透過自然語言互動介面，讓非技術人員也能輕鬆存取資料庫數據。

**主要優勢：**

- **直覺易用性：**  
  完全無需掌握 SQL 語法，即可進行資料庫查詢。
  
- **動態 Schema 注入：**  
  根據使用者選擇的表格，自動注入相關 Schema 資訊，避免資訊過載。
  
- **自動 SQL 生成與錯誤修正：**  
  自動生成 SQL 語句，並在查詢錯誤時主動檢測修正，減少人工干預。
  
- **自然語言回覆：**  
  完全隱藏 SQL 查詢細節，以自然語言回覆查詢結果，提升使用者體驗。
  
- **擴展性：**  
  能夠適應大型 Data Mart 的多表、多 Schema 動態環境需求。

---

## 目錄

1. [摘要 (Abstract)](#摘要-abstract)
2. [研究動機 (Introduction)](#研究動機-introduction)
3. [相關研究 (Related Work)](#相關研究-related-work)
4. [研究方法 (Methodology)](#研究方法-methodology)
5. [實驗與評估 (Experiments-&-Evaluation)](#實驗與評估-experiments--evaluation)
6. [專案亮點](#專案亮點)

---

## 摘要 (Abstract)

隨著企業 Data Mart 中表格數量與 Schema 結構快速成長，現有的 Text-to-SQL 工具難以處理動態變化的資料庫結構與大量表格組合。現有研究（如 Spider Dataset）僅適用於固定 Schema，且仍需使用者手動修正錯誤的 SQL，難以擴展到企業實際應用情境。

**本專案提出 SQLess  Text-to-SQL 解決方案，特點包括：**

- 動態 Schema 選取機制
- Schema 內嵌式 SQL 自動生成
- SQL 查詢結果的自然語言回覆
- 自動 SQL 錯誤檢測與動態修正
- 完全隱藏 SQL 查詢流程

透過這些機制，SQLess 為企業環境提供更高的易用性、準確率及可擴展性。

---

## 研究動機 (Introduction)

**應用潛力：**

- 讓非技術人員能夠使用自然語言輕鬆存取企業數據，提高數據分析效率。

**現有解決方案的限制：**

- **Spider Dataset：**  
  僅適合靜態、固定的 Schema，缺乏靈活性。

- **Vanna AI + RAG：**  
  需蒐集大量問答資料，成本高且無法處理未知查詢。

- **傳統 Text-to-SQL：**  
  需人工審視 SQL 語法，且錯誤無法自動修正，使用體驗差。

** Data Mart 的挑戰：**

- 數百張表格、動態多變的結構。
- 非技術人員難以手動調整錯誤 SQL。
- 提升查詢效率與準確性、降低使用門檻的需求日益迫切。

---

## 相關研究 (Related Work)

### 3.1. Spider Dataset 與固定 Schema 模型

- 限制：  
  缺乏動態調整 Schema 的能力，難以擴展到資料庫使用。

### 3.2. Retrieval-Augmented Generation（RAG）方案

- 例如：  
  Vanna AI 等工具，需透過歷史問答資料進行配對，成本高且靈活性不足。

### 3.3. LLM 生成 SQL

- 例子：  
  GPT-4、CodeX 等模型可以生成 SQL，但當執行錯誤時需人工介入，無法自動修正，這對非技術人員來說較為困難。

---

## 研究方法 (Methodology)

SQLess 涵蓋三大核心功能：

1. **SQL 自動生成**  
2. **SQL 錯誤自動修正**  
3. **自然語言回覆**

### 系統架構與流程

1. **動態 Schema 選取**  
   - 使用者選擇欲查詢的表格，系統自動載入對應 Schema。
   
2. **內嵌 Schema 生成 SQL**  
   - 將 Schema 資訊內嵌於 Prompt，讓 LLM 自動生成 SQL 語句。
   
3. **執行 SQL，取得結果**

4. **自然語言回覆**  
   - 將查詢結果經 LLM 轉換為自然語言，隱藏 SQL 操作細節，提升使用者體驗。
   
5. **自動錯誤檢測與修正**  
   - 當 SQL 執行失敗時，系統自動檢測錯誤、修正並重新執行。
   
6. **使用者互動確認**  
   - 如持續發生錯誤，系統將詢問使用者確認查詢條件與欄位，再進行查詢。

**流程示意圖：**

![SQLess 查詢系統運作流程](https://github.com/user-attachments/assets/b3ecec38-b35a-439d-a09d-64277b4e9735)

### 核心技術說明

- **動態 Schema 注入 (Context Injection)：**  
  使用者選取的表格自動載入 Schema，降低 Prompt 資訊過載，提升生成精準度。

- **SQL 錯誤檢測與修正機制：**  
  結合語法檢查、Schema 比對與使用者條件驗證，自動修正錯誤並重新生成 SQL。

- **自然語言回覆機制：**  
  利用 LLM 將 SQL 查詢結果轉譯為易理解的自然語言，完全隱藏 SQL 細節。

---

## 實驗與評估 (Experiments & Evaluation)

**測試資料環境：**

-  Data Mart 實測環境
- 涵蓋超過 100 張表格
- 涉及多領域資料（如財務、行銷、庫存等）
- 每次查詢時 Schema 都會動態變化，測試系統在真實情境下的穩定性與準確性

---

## 專案亮點

- ✅ **免 SQL 語法理解**
- ✅ **動態 Schema 載入與查詢**
- ✅ **自動生成與修正 SQL 語句**
- ✅ **自然語言查詢結果回覆**

---

**SQLess** 讓企業資料查詢變得輕鬆且直覺，即使不懂 SQL 也能輕鬆上手，助您提升數據分析效率！ 🚀✨
