import random
from datetime  import datetime
import tiktoken

def token_count(text):
    encoder = tiktoken.encoding_for_model(model)
    tokens = encoder.encode(text)
    return len(tokens)



ai_version = 'azure'
api_key = ''
version = 'gpt-4o'
service = 'azure' 
api_version = ''
endpoint = ''


# open ai token è¨ˆç®—æ¨¡çµ„
model = "gpt-4o"

# è³‡æ–™åº«é€£ç·šè³‡è¨Š
host = ''
port = ''
service_name = ''
username = ''
password = ''






emo_list = ['ä½ æ˜¯æ˜¯å°ˆæ¥­çš„æ•¸æ“šåˆ†æå¸«']

# åˆ¤æ–·æ˜¯å¦è¦æŸ¥è³‡æ–™
def detect_data_related_question(user_input):
    output = fr'''
ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„ AI åŠ©ç†ï¼Œè² è²¬åˆ¤æ–·ä½¿ç”¨è€…çš„å•é¡Œæ˜¯å¦èˆ‡æ•¸æ“šæŸ¥è©¢ç›¸é—œã€‚

### ğŸ“Œ åˆ¤æ–·æ¨™æº–ï¼š
- **æ•¸æ“šç›¸é—œå•é¡Œ** é€šå¸¸åŒ…å«ï¼š
  - éœ€è¦æŸ¥è©¢ã€ç¯©é¸ã€è¨ˆç®—æˆ–çµ±è¨ˆçš„å…§å®¹
  - å¯èƒ½æ¶‰åŠæ™‚é–“ã€æ•¸é‡ã€é‡‘é¡ã€è¶¨å‹¢ã€è®ŠåŒ–ã€æ’åç­‰
  - å¯èƒ½æåŠç‰¹å®šçš„æ¢ä»¶ï¼Œä¾‹å¦‚æŸå€‹å€åŸŸçš„éŠ·é‡ã€æŸæ®µæ™‚é–“å…§çš„è®ŠåŒ–ç­‰

- **éæ•¸æ“šå•é¡Œ** å¯èƒ½æ˜¯ï¼š
  - è©¢å•æ¦‚å¿µã€èƒŒæ™¯çŸ¥è­˜æˆ–ä¸€èˆ¬è¨è«–
  - è©¢å•è¦å‰‡ã€æ”¿ç­–æˆ–æ¥­å‹™é‚è¼¯ï¼Œè€Œä¸æ˜¯å…·é«”çš„æ•¸æ“šæŸ¥è©¢
  - éœ€è¦ä¸€èˆ¬æ€§çš„å»ºè­°æˆ–æ±ºç­–å»ºè­°ï¼Œè€Œéå…·é«”æ•¸æ“š

è«‹åˆ¤æ–·ä»¥ä¸‹å•é¡Œæ˜¯å¦èˆ‡æ•¸æ“šæŸ¥è©¢ç›¸é—œï¼Œä¸¦å›è¦† **ã€Œæ˜¯ã€æˆ–ã€Œå¦ã€**ï¼š
---
ä½¿ç”¨è€…å•é¡Œï¼š
"{user_input}"
---
è«‹åƒ…å›è¦† **ã€Œæ˜¯ã€æˆ–ã€Œå¦ã€**ï¼Œä¸å¾—æä¾›é¡å¤–èªªæ˜ã€‚
'''
    print('ç¬¬0æ§schemaç¯©é¸:',token_count(output))
    return output

#schemaç¯©é¸ç›¸é—œçš„prompt
def prompt_schema(user_input, table_name, table_schema):

    output = fr'''
ä½ æ˜¯è³‡æ·±æ•¸æ“šå·¥ç¨‹å¸«ã€‚æ ¹æ“šä½¿ç”¨è€…è¼¸å…¥ï¼Œç²¾æº–ç¯©é¸SQLå¯èƒ½ç”¨åˆ°çš„Schemaæ¬„ä½ï¼š

ã€ä½¿ç”¨è€…å•é¡Œã€‘ï¼š
{user_input}

ã€è³‡æ–™è¡¨åç¨±ã€‘ï¼š
{table_name}

ã€Schemaæ¬„ä½ã€‘ï¼š
{table_schema}

ã€ä»»å‹™è¦æ±‚ã€‘ï¼š
- æ ¹æ“šä»¥ä¸Šè³‡è¨Šï¼Œåˆ¤æ–·æ­¤æ¬¡å•é¡Œæ˜¯å¦é€£è²«ï¼Œä¸¦åˆ—å‡ºå¯èƒ½è¢«ä½¿ç”¨åˆ°çš„æ¬„ä½ã€‚
- è‹¥æœ‰åç¨±ç›¸ä¼¼æˆ–èªæ„æ¥è¿‘çš„æ¬„ä½ï¼Œå…¨éƒ¨åˆ—å‡ºï¼Œä¸å¯åˆä½µæˆ–çœç•¥ã€‚

- æœ€å¾Œä»¥ **markdownæ ¼å¼å‘ˆç¾**ï¼Œåƒ…åŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š
  column_name, æ ¼å¼, COLUMN_COMMENT(å®Œæ•´å…§å®¹), COLUMN_LOGIC(å®Œæ•´å…§å®¹)

ã€æ³¨æ„äº‹é …ã€‘ï¼š
- åªè¼¸å‡ºè¡¨æ ¼å…§å®¹ï¼Œä¸å…è¨±å…¶ä»–æ–‡å­—èªªæ˜æˆ–å»¢è©±ã€‚
- å‹™å¿…ä¿ç•™COLUMN_COMMENTèˆ‡COLUMN_LOGICå®Œæ•´åŸæ–‡ï¼Œä¸å¯çœç•¥ã€‚
- ç¦æ­¢èŠ±è²»éå¤šæ™‚é–“æ€è€ƒï¼Œç«‹å³å›è¦†ã€‚
'''

    print('ç¬¬ä¸€æ§schemaç¯©é¸:',token_count(output))
    return output

#ç¬¬ä¸€æ¬¡TEXTTOSQLè½‰æ›
def prompt_SQL(user_input,table_name,table_schema,table_comment,OWNER_SCHEMA):
    output = fr'''
ä½ æ˜¯å°ˆæ¥­çš„æ•¸æ“šå·¥ç¨‹å¸«ï¼Œä½¿ç”¨è€…å•é¡Œå¦‚ä¸‹:

{user_input}

ç•¶å‰æ—¥æœŸ:{datetime.now().strftime('%Y-%m-%d')}

è«‹åƒè€ƒä»¥ä¸‹table_commentè³‡è¨Š:
{table_comment}

è«‹æ³¨æ„ï¼š
2. å·²æ‰¾åˆ°è¡¨åç‚º `{table_name}`ï¼Œå…¶ schema è³‡è¨Š(**è«‹ç”¨markdownæ ¼å¼è§£è®€**)ï¼š
{table_schema}

3. è«‹åƒè€ƒä»¥ä¸Šschemaè³‡è¨Š(**è‹¥COLUMN_LOGICæœ‰å€¼è«‹**åƒè€ƒä¸è¦ç…§æŠ„**è©²æ¬„ä½æ¢ä»¶ï¼Œä¸ç„¶æˆ‘æœƒè¢«é–‹é™¤**)ä¸¦æ ¹æ“š ä½¿ç”¨è€…å•é¡Œï¼Œç¯©é¸**å¿…è¦**çš„æ¬„ä½ï¼Œç”Ÿæˆç¬¦åˆè¦æ±‚ä¸”æ­£ç¢ºçš„ Oracle SQL æŸ¥è©¢èªå¥ã€‚
4. åœ°åè‡ªå‹•è½‰è‹±æ–‡ï¼Œæ¢ä»¶ç›¡é‡ä½¿ç”¨ in (ç°¡å¯«ï¼Œå…¨å¯«)ã€‚
5. å®¢æˆ¶åå‰‡åˆ¤æ–·æ˜¯å¦éœ€è½‰è‹±æ–‡ï¼Œæ¢ä»¶ç›¡é‡ä½¿ç”¨ LIKE %ã€‚
6. çœ‹åˆ° & è«‹ä½¿ç”¨ in (æ¢ä»¶,æ¢ä»¶)ã€‚
7. æ¢ä»¶æ ¼å¼ï¼šTRIM(UPPER(REPLACE(æ¬„ä½,' ',''))) = TRIM(UPPER(REPLACE(INPUT,' ',''))) ï¼Œå¦‚æœä½¿ç”¨è€…å•é¡Œæ²’æœ‰æ˜ç¢ºè·Ÿä½ èªªæ¢ä»¶ï¼Œè«‹å‹¿è‡ªè¡Œä¸‹æ¢ä»¶ã€‚
8. å…¶ä»–æ¢ä»¶:è«‹ç›¡é‡ä½¿ç”¨èšåˆå‡½æ•¸ä¾†å£“ç¸®è³‡æ–™é‡é«”ï¼Œä¸¦ä¸”æ¬„ä½åšèšåˆå¾Œè«‹é‡æ–°å‘½åã€‚
   
9. æ ¹æ“šè¦æ±‚ & COLUMN_LOGIC è«‹è¼¸å‡ºä¸€å¥ ç°¡å–®ä¸”æ­£ç¢ºçš„SQLï¼Œè«‹çµ¦äºˆæœ€ä½é™åº¦çš„æ•¸æ“šé‡ï¼Œä¹Ÿå¯ä»¥ç”¨withï¼Œæ ¼å¼å¿…é ˆç¬¦åˆï¼š
SELECT æ¬„ä½ FROM {OWNER_SCHEMA}.{table_name} WHERE TRIM(UPPER(REPLACE(æ¬„ä½,' ',''))) = TRIM(UPPER(REPLACE(INPUT,' ',''))) ORDER BY æ¬„ä½ ASC
ä¸¦åœ¨çµå°¾**å‹™å¿…é™„ä¸Š** :   FETCH FIRST **æ ¹æ“šéœ€æ±‚è€Œå®šæ•¸é‡(é è¨­æœ€å¤š1000000)** ROWS ONLY;

10.ç¦æ­¢ä½¿ç”¨EXTRACT(quarter FROM )
11.åœ¨SQLå…§ä»»ä½•æ¢ä»¶è¨ˆç®—è«‹è¨ˆç®—å®Œå¾Œå†é€²è¡Œç¯©é¸ã€‚


ps.å¦‚æœæ‰¾ä¸åˆ° ä½¿ç”¨è€…å•é¡Œ æ‰€æåˆ°çš„æ¢ä»¶æ¬„ä½ï¼Œè«‹å›è¦†ç„¡æ³•æ‰¾åˆ°ç›¸é—œè³‡æ–™ã€‚
'''
    print('ç¬¬äºŒæ§sqlç”¢ç”Ÿç¯©é¸:',token_count(output))
    return output

#åŸ·è¡Œå¤±æ•—å¾Œï¼Œç¬¬äºŒæ¬¡TEXTTOSQLè½‰æ›
def prompt_reSQL(user_input,sql_query,query_result,table_schema,table_comment):
    output = fr'''
ä¸Šä¸€ç‰ˆ SQL è¼¸å‡ºå¦‚ä¸‹ï¼š
{sql_query}
ä½†æŸ¥è©¢çµæœç‚ºï¼š
{query_result}
è«‹åƒè€ƒä»¥ä¸‹ table schema (**è«‹ç”¨markdownæ ¼å¼è§£è®€**)ï¼š
{table_schema}

è«‹åƒè€ƒä»¥ä¸‹table_commentè³‡è¨Š:
{table_comment}

ç•¶å‰æ—¥æœŸ:{datetime.now().strftime('%Y-%m-%d')}

ä½ æ˜¯å°ˆæ¥­çš„æ•¸æ“šå·¥ç¨‹å¸«ï¼Œè«‹å†æ¬¡æ ¹æ“š{user_input}è¦æ±‚ç”Ÿæˆç¬¦åˆæ¢ä»¶çš„ Oracle SQL æŸ¥è©¢èªå¥(**è‹¥COLUMN_LOGICæœ‰å€¼è«‹ç‰¹åˆ¥**åƒè€ƒä¸è¦ç…§æŠ„**è©²æ¬„ä½æ¢ä»¶**)ï¼š

- ç¢ºèª WHERE æ¢ä»¶ç¬¦åˆ Oracle SQL è¦ç¯„

- è‹¥æœ‰åœ°åï¼Œè½‰è‹±æ–‡ä½¿ç”¨ in (ç°¡å¯«ï¼Œå…¨å¯«)

- è‹¥æœ‰å®¢æˆ¶åï¼Œåˆ¤æ–·æ˜¯å¦è½‰è‹±æ–‡ä¸¦ä½¿ç”¨ LIKE %æŸ¥è©¢

- æ¢ä»¶æ ¼å¼ï¼šTRIM(UPPER(REPLACE(æ¬„ä½,' ',''))) = TRIM(UPPER(REPLACE(INPUT,' ',''))) or TRIM(UPPER(REPLACE(æ¬„ä½,' ',''))) like TRIM(UPPER(REPLACE(%INPUT%,' ','')))

- å…¶ä»–æ¢ä»¶:*****è«‹å‹™å¿…ä½¿ç”¨èšåˆå‡½æ•¸ä¾†å£“ç¸®è³‡æ–™é‡é«”*****ä¸¦ä¸”æ¬„ä½åšèšåˆå¾Œè«‹é‡æ–°å‘½åï¼Œå¦å¤–æ ¹æ“šè¦æ±‚ï¼Œè«‹çµ¦äºˆæœ€ä½é™åº¦çš„æ•¸æ“šé‡ï¼Œã€‚

- è«‹è¼¸å‡ºä¸€å¥æŸ¥è©¢èªå¥ï¼Œçµå°¾**å‹™å¿…é™„ä¸Š** :  FETCH FIRST **æ ¹æ“šéœ€æ±‚è€Œå®šæ•¸é‡(é è¨­æœ€å¤š1000000)** ROWS ONLY;

- ç¦æ­¢ä½¿ç”¨EXTRACT(quarter FROM )

- åœ¨SQLå…§ä»»ä½•æ¢ä»¶è¨ˆç®—è«‹è¨ˆç®—å®Œå¾Œå†é€²è¡Œç¯©é¸ã€‚

ps.å¦‚æœæ‰¾ä¸åˆ° ä½¿ç”¨è€…å•é¡Œ æ‰€æåˆ°çš„æ¢ä»¶æ¬„ä½ï¼Œè«‹å›è¦†ç„¡æ³•æ‰¾åˆ°ç›¸é—œè³‡æ–™ã€‚

'''
    print('ç¬¬ä¸‰æ§sqlç”¢ç”Ÿç¯©é¸:',token_count(output))
    return output

#æŸ¥è©¢çµæœç¸½çµ
def prompt_final_result_fail(time, sql_query, query_result, table_schema):
    random_choice = random.choice(emo_list)
    output = fr'''
            ç•¶å‰æ—¥æœŸ:{time}
            è«‹æ ¹æ“š

            è¼¸å‡ºçš„sql = 
            {sql_query}

            çµæœ:
            {query_result}

            table schema = 
            {table_schema}

            -æŸ¥ç„¡è³‡æ–™
            -**{random_choice}è·ŸUSERèªªæ²’æœ‰æ‰¾åˆ°è³‡æ–™(é€™éƒ¨åˆ†ä½ è‡ªå·±ç™¼æ®çœ‹è¦æ€éº¼è¬›useræ‰æœƒè²·å–®)**

            -ç›®å‰çš„ç¯©é¸
            (åªå›è¦†ä¸€æ¬¡ï¼Œ**ä¸è¦æåˆ°ä½ æˆ‘ä»–**) whereç¯©é¸çš„æ¬„ä½**(ä¸ç”¨å›è¦†ç”¨åˆ°çš„å‡½æ•¸ & where)** =  **è¼¸å‡ºçš„sql** çµ¦çš„æ¢ä»¶(æœ‰è¨ˆç®—çš„è©±çµ¦æˆ‘è¨ˆç®—å®Œçš„å€¼ï¼Œæ—¥æœŸçµ¦æˆ‘å¯¦éš›çš„æ•¸å­—ï¼Œå…¶é¤˜çµ¦æˆ‘ä¸€èˆ¬å€¼ï¼Œæ²’æœ‰å‰‡é¡¯ç¤ºç„¡)ï¼Œä¸¦è©¢å•æ¢ä»¶åŠæ¬„ä½åç¨±æ˜¯å¦æ­£ç¢ºã€‚ 
            ** è«‹è®€å–dataframeæ ¼å¼ä¸¦ç”¨**è¡¨æ ¼å‘ˆç¾** >>{{è¼¸å‡ºçš„æ¬„ä½åç¨±: [**æ¬„ä½åç¨±(è‹±æ–‡) åŠ ä¸Š(COLUMN_COMMENT)**], æ¢ä»¶å€¼:[å€¼] }}

            -ç›¸ä¼¼æ¬„ä½
            (åªå›è¦†ä¸€æ¬¡ï¼Œ**ä¸è¦æåˆ°ä½ æˆ‘ä»–**):åƒè€ƒ**è¼¸å‡ºsql where & selectå¾Œé¢çš„**æ‰€æœ‰**æ¬„ä½ & åƒè€ƒ **æ‰€æœ‰table schemaç›¸ä¼¼çš„æ¬„ä½åç¨±**æˆ–å¦‚æœæœ‰USERçµ¦çš„æ¬„ä½æ˜¯SCHEMAéƒ½æ²’æœ‰æŸ¥åˆ°çš„ï¼Œè«‹å‘ŠçŸ¥ï¼Œä¸¦çµ¦USERä½ è¦ºå¾—å¯èƒ½èˆ‡ä¹‹ç›¸ä¼¼çš„æ‰€æœ‰column name æœ‰å“ªäº›? \
            ** è«‹è®€å–dataframeæ ¼å¼ä¸¦ç”¨**è¡¨æ ¼å‘ˆç¾** >>{{è¼¸å‡ºçš„æ¬„ä½åç¨±: [**æ¬„ä½åç¨±(è‹±æ–‡) åŠ ä¸Š(COLUMN_COMMENT)**], ç›¸ä¼¼çš„æ¬„ä½: [**æ‰€æœ‰ç›¸ä¼¼çš„æ¬„ä½ åŠ ä¸Š(COLUMN_COMMENT)**] }} æ¯å€‹æ¬„ä½è«‹æ›è¡Œ**

            -ç›¸ä¼¼æ¢ä»¶å€¼
            (åªå›è¦†ä¸€æ¬¡ï¼Œ**ä¸è¦æåˆ°ä½ æˆ‘ä»–**): åƒè€ƒè¼¸å‡ºsql whereçš„æ¢ä»¶**å€¼**ï¼Œçµ¦USERä½ è¦ºå¾—å¯èƒ½èˆ‡ä¹‹ç›¸åŒçš„å€¼æœ‰å“ªäº›? ex. TAIWAN = TW, US = USA, AMERICA, APPLE = APPL, NVDA = NVDIA
             **ç”¨è¡¨æ ¼å½™æ•´>> è¼¸å‡ºçš„æ¢ä»¶å€¼,å¯èƒ½çš„æ¢ä»¶å€¼ã€‚**

            -å›å¾©çš„æ™‚å€™ä¸è¦æœ‰**SQL**é€™ä¸‰å€‹ç›¸é—œçš„å­—ï¼Œä¹Ÿä¸ç”¨å›å¾©FETCHçš„æ¢ä»¶
        '''
    print('ç¬¬å››æ§å¤±æ•—:',token_count(output))
    return output

#æˆåŠŸä½†è³‡æ–™é‡éå¤§
def prompt_final_result_limit(time,user_input,sql_query,table_schema):
    random_choice = random.choice(emo_list)
    output = fr'''
            ç•¶å‰æ—¥æœŸ:{time}
            è«‹æ ¹æ“šä¸‹åˆ—è³‡è¨Šï¼Œä½¿ç”¨{random_choice}ï¼Œç›´æ¥å›ç­”ä½¿ç”¨è€…çš„å•é¡Œã€‚è«‹æ³¨æ„ï¼š

            åš´ç¦åœ¨å›ç­”ä¸­å‡ºç¾ä»»ä½•ç¨‹å¼ç¢¼æˆ–èˆ‡ç¨‹å¼å¯¦ä½œç›¸é—œçš„æè¿°ã€‚

            ä½¿ç”¨è€…å•é¡Œï¼š
            {user_input}

            è¼¸å‡ºçš„sql:
            {sql_query}
           
            schema:
            {table_schema}


            é–‹é ­:å¾ˆæŠ±æ­‰ï¼Œå› ç‚ºè³‡æ–™é‡é¾å¤§ï¼Œç„¡æ³•ä¸€æ¬¡æ€§å‘ˆç¾æ‰€æœ‰è³‡æ–™ï¼Œè«‹é»é¸å°è©±æ¡†ä¸‹è¼‰æŒ‰éˆ•~
            
            ä¸€æ¨£è¦çµ¦ user:
                -å›è¦†çµ¦USER åƒè€ƒ(åªå›è¦†ä¸€æ¬¡ï¼Œ**ä¸è¦æåˆ°ä½ æˆ‘ä»–**): *where*  ç¯©é¸çš„æ¬„ä½**(ä¸ç”¨å›è¦†ç”¨åˆ°çš„å‡½æ•¸ & "WHERE"é€™å€‹å­— & GROUP BY, ORDER BY çš„æ¬„ä½  & SELECT çš„æ¬„ä½)** =  **è¼¸å‡ºçš„sql** çµ¦çš„æ¢ä»¶(æœ‰è¨ˆç®—çš„è©±çµ¦æˆ‘è¨ˆç®—å®Œçš„å€¼ï¼Œå…¶é¤˜çµ¦æˆ‘ä¸€èˆ¬å€¼ï¼Œæ²’æœ‰å‰‡ä¸è¦é¡¯ç¤º)ã€‚ 
                 ç”¨**è¡¨æ ¼å‘ˆç¾ä»¥ä¸‹å…§å®¹** >>
                 |ç¯©é¸çš„æ¬„ä½| æ¢ä»¶å€¼|
                 |---|---|
                 |**according to schema, present with **column_name** and (column comment) else you'll be fired** | **è¼¸å‡ºçš„sql** çµ¦çš„æ¢ä»¶ä¸ç”¨å›è¦†ç”¨åˆ°çš„å‡½æ•¸ |

                -(åªå›è¦†ä¸€æ¬¡ï¼Œ**ä¸è¦æåˆ°ä½ æˆ‘ä»–ä»¥åŠSELECTé€™å€‹å­—**) *SELECT* å¾Œé¢ç”¨åˆ°çš„**åŸå§‹**æ¬„ä½åç¨± (ä¸ç”¨å›è¦†ç”¨åˆ°çš„å‡½æ•¸ä»¥åŠ as å¾Œé¢çš„æ¬„ä½åç¨±)
                 ç”¨**è¡¨æ ¼å‘ˆç¾ä»¥ä¸‹å…§å®¹** >>
                 |ç”¨åˆ°çš„åŸå§‹çš„æ¬„ä½|
                 |---|
                 |**according to schema, present with **column_name** and (column comment) else you'll be fired**|
            
            -å›å¾©çš„æ™‚å€™ä¸è¦æœ‰**SQL**é€™ä¸‰å€‹ç›¸é—œçš„å­—ï¼Œä¹Ÿä¸ç”¨å›å¾©FETCHçš„æ¢ä»¶

            '''
    print('ç¬¬å››æ§æˆåŠŸéå¤§:',token_count(output))
    return output

#æˆåŠŸ
def prompt_final_result_success(time,user_input,sql_query,query_result,table_schema,table_comment):
    random_choice = random.choice(emo_list)
    output = fr'''

            ç›¸é—œçµæœå¦‚ä¸‹:

            {query_result}

            ä½¿ç”¨è€…å•é¡Œï¼š
            {user_input}

            è¼¸å‡ºçš„sql:
            {sql_query}

            schema:
            {table_schema}

            å…¶ä»–æ³¨æ„äº‹é …:
            {table_comment}

            ç•¶å‰æ—¥æœŸ:{time}

            ç‰ˆé¢é…ç½®:
            ç”±ä¸Šè€Œä¸‹:   åŸå§‹æ•¸æ“šå‘ˆç¾ >> ç›¸é—œæ¢ä»¶è³‡è¨Š

            
            ps.**{random_choice}ï¼Œç°¡å–®åˆç°¡çŸ­çš„åˆ†æä¸€ä¸‹å…§å®¹**ï¼š
            åŸå§‹æ•¸æ“šå‘ˆç¾:
            (ä¸ç®¡å­—ä¸²é•·æˆ–çŸ­éƒ½ä»¥è¡¨æ ¼å‘ˆç¾ï¼Œä¸¦ä¸”è¦æœ‰è¡¨é ­ï¼Œè¡¨é ­è«‹ç™½è©±ç¿»è­¯)
            
            ç›¸é—œæ¢ä»¶è³‡è¨Š:
                -å›è¦†çµ¦USER åƒè€ƒ(åªå›è¦†ä¸€æ¬¡ï¼Œ**ä¸è¦æåˆ°ä½ æˆ‘ä»–**): *where*  ç¯©é¸çš„æ¬„ä½**(ä¸ç”¨å›è¦†ç”¨åˆ°çš„å‡½æ•¸ &  "WHERE"é€™å€‹å­—  & GROUP BY, ORDER BY çš„æ¬„ä½  & SELECT çš„æ¬„ä½)** =  **è¼¸å‡ºçš„sql** çµ¦çš„æ¢ä»¶(æœ‰è¨ˆç®—çš„è©±çµ¦æˆ‘è¨ˆç®—å®Œçš„å€¼ï¼Œå…¶é¤˜çµ¦æˆ‘ä¸€èˆ¬å€¼ï¼Œæ²’æœ‰å‰‡ä¸è¦é¡¯ç¤º)ã€‚ 
                 ç”¨**è¡¨æ ¼å‘ˆç¾ä»¥ä¸‹å…§å®¹** >>
                 |ç¯©é¸çš„æ¬„ä½| æ¢ä»¶å€¼|
                 |---|---|
                 |**according to schema, present with **column_name** and (column comment) else you'll be fired** | **è¼¸å‡ºçš„sql** çµ¦çš„æ¢ä»¶ä¸ç”¨å›è¦†ç”¨åˆ°çš„å‡½æ•¸ |

                -(åªå›è¦†ä¸€æ¬¡ï¼Œ**ä¸è¦æåˆ°ä½ æˆ‘ä»–ä»¥åŠSELECTé€™å€‹å­—**)*SELECT* å¾Œé¢ç”¨åˆ°çš„**åŸå§‹**æ¬„ä½åç¨± (ä¸ç”¨å›è¦†ç”¨åˆ°çš„å‡½æ•¸ä»¥åŠ as å¾Œé¢çš„æ¬„ä½åç¨±)
                 ç”¨**è¡¨æ ¼å‘ˆç¾ä»¥ä¸‹å…§å®¹** >>
                 |ç”¨åˆ°çš„åŸå§‹çš„æ¬„ä½|
                 |---|
                 |**according to schema, present with **column_name** and (column comment) else you'll be fired**|
                 
            å›å¾©çš„æ™‚å€™ä¸è¦æœ‰**SQL**é€™ä¸‰å€‹ç›¸é—œçš„å­—ï¼Œä¸ç”¨å›å¾©FETCHçš„æ¢ä»¶ï¼Œä¹Ÿä¸ç”¨å›å¾©**COLUMN_COMMENTé€™å€‹å­—**
            '''

    print('ç¬¬å››æ§æˆåŠŸ:',token_count(output))
    return output

#éæ•¸æ“šå•é¡Œ
def prompt_not_data_related_question(user_input):
    return fr'''è«‹æ ¹æ“š{user_input}çš„å•é¡Œï¼Œå›ç­”ä»–çš„ç–‘å•ã€‚'''
